var JsonFormatter={stringify:function(n){var t={ct:n.ciphertext.toString(CryptoJS.enc.Base64)};return n.iv&&(t.iv=n.iv.toString()),JSON.stringify(t)},parse:function(n){var t=JSON.parse(n),i=CryptoJS.lib.CipherParams.create({ciphertext:CryptoJS.enc.Base64.parse(t.ct)});return t.iv&&(i.iv=CryptoJS.enc.Hex.parse(t.iv)),i}};App=Ember.Application.create(),App.Router.map(function(){this.resource("chat")}),App.User=Ember.Object.extend({name:"",id:"",status:!0,upload:!0}),App.Message=Ember.Object.extend({name:"",message:"",fromServer:function(){var n=this.get("name");return n==="SERVER"}.property("name"),postedAt:new Date}),App.Room=Ember.Object.extend({name:"",password:"",salt:null,key:null,users:null,messages:null}),App.Client=App.User.extend({backgroundWorker:0,connected:!1,currentTime:new Date,currentRoom:App.Room.create({name:"",password:"",salt:null,key:null,users:Em.A([]),usersFormated:function(){alert(this.get("users").find({name:this.get("name")}))},messages:Em.A([])})}),App.CurrentClient,App.IndexRoute=Ember.Route.extend({model:function(){return App.CurrentClient=App.Client.create()},setupController:function(n,t){n.set("content",t)}}),App.IndexController=Ember.ObjectController.extend({startNew:function(){var n=App.CurrentClient.get("currentRoom").get("name"),t={room:n};Socket.emit("setupUser",t,function(n){var t=App.CurrentClient.get("currentRoom"),f,e;if(n&&n.salt&&n.roomExists){var r=t.get("password"),i=CryptoJS.enc.Hex.parse(n.salt),u=CryptoJS.PBKDF2(r,i,{keySize:8,iterations:1e3});t.set("salt",i),t.set("key",u)}else if(n&&!n.roomExists&&n.salt===null){var r=t.get("password"),i=CryptoJS.lib.WordArray.random(128),u=CryptoJS.PBKDF2(r,i,{keySize:8,iterations:1e3});t.set("salt",i),t.set("key",u),f={room:t.get("name"),salt:CryptoJS.enc.Hex.stringify(i)},Socket.emit("createRoom",f)}e={username:App.CurrentClient.get("name")},Socket.emit("checkName",e,function(n){if(n&&!n.nameExists){var t={name:App.CurrentClient.get("name"),room:App.CurrentClient.get("currentRoom").get("name")};Socket.emit("joinRoom",t,function(n){if(n&&n.users){var t=App.CurrentClient.get("currentRoom");t.set("users",n.users),document.location=document.location+"#/chat/"}})}})})}}),App.ChatRoute=Ember.Route.extend({model:function(){return App.CurrentClient},setupController:function(n,t){n.set("content",t),t.set("backgroundWorker",setInterval(function(){t.set("currentTime",new Date)},3e4))}}),App.ChatController=Ember.ObjectController.extend({newMessage:"",showSettings:!1,showInfo:!1,chatListHeight:0,sendChat:function(){var n=App.CurrentClient.get("currentRoom"),t=App.CurrentClient.get("name"),i=n.get("key"),r=this.get("newMessage"),u=CryptoJS.AES.encrypt(r,i,{iv:CryptoJS.lib.WordArray.random(16),format:JsonFormatter}),f=u.toString();Socket.emit("sendChat",{name:t,message:f,postedAt:new Date}),this.set("newMessage",""),Em.$("#newMsg").focus()},disconnect:function(){clearInterval(this.get("backgroundWorker")),Socket.disconnect(),App.CurrentClient.get("currentRoom").destroy(),App.CurrentClient.destroy(),document.location="https://69.248.167.141:8001"},changeStatus:function(){App.CurrentClient.set("status",!App.CurrentClient.get("status"));var n=App.CurrentClient.get("name"),t=App.CurrentClient.get("status");Socket.emit("changeStatus",{name:n,status:t})},showInfo:function(){},showSettings:function(){}}),App.MessageTextField=Ember.TextField.extend({attributeBindings:["autofocus"],keyUp:function(n){n.which===13&&this.get("controller").send("sendChat")}}),App.UserInfoTextField=Ember.TextField.extend({attributeBindings:["autofocus"],keyUp:function(n){n.which===13&&this.get("controller").send("startNew")}}),App.ChatListView=Ember.View.extend({tagName:"li",didInsertElement:function(){$("#chatList").scrollTop(1e9),this._super()}}),App.UserListView=Ember.View.extend({tagName:"li",showFileUpload:function(){},sendFile:function(){}}),Ember.Handlebars.registerBoundHelper("timeForm",function(n,t){var i=t.hash.time;return moment(n).from(i)}),Socket=io.connect("https://69.248.167.141:8001",{secure:!0});Socket.on("connect",function(){App.CurrentClient.set("connected",!0)});Socket.on("addUser",function(n){n&&n.name&&n.id&&n.status&&App.CurrentClient.get("currentRoom").get("users").pushObject(App.User.create({name:n.name,id:n.id,status:n.status}))});Socket.on("removeUser",function(n){if(n&&n.id){var t=App.CurrentClient.get("currentRoom").get("users");t.removeObject(t.findProperty("id",n.id))}});Socket.on("updateUser",function(n){n&&n.name&&n.id&&n.status&&App.CurrentClient.get("currentRoom").get("users").find({id:n.id}).set("status",n.status)});Socket.on("updateChat",function(n){var i,t;if(n&&n.message&&n.name&&n.postedAt)if(i=App.CurrentClient.get("currentRoom"),t=App.CurrentClient.get("currentTime"),n.name==="SERVER")i.get("messages").pushObject(App.Message.create({name:n.name,message:n.message,postedAt:n.postedAt>t?t:n.postedAt}));else{var u=i.get("key"),r=JsonFormatter.parse(n.message),f=CryptoJS.AES.decrypt(r,u,{iv:r.iv}),e=f.toString(CryptoJS.enc.Utf8);i.get("messages").pushObject(App.Message.create({name:n.name,message:e,postedAt:n.postedAt>t?t:n.postedAt}))}});
//@ sourceMappingURL=Client.min.js.map